import{u as B,d as q,r as l,j as e,_ as F}from"./index-BpdBFQQS.js";import{F as U}from"./Footer-CowGUUib.js";import{c as C}from"./createLucideIcon-D4oJ_o-y.js";import{X as z}from"./x-PgglTxAF.js";import{D as W}from"./download-VCnS2YPQ.js";import"./map-pin-CXwquIrr.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=C("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=C("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),y=c=>`${Number(c||0).toLocaleString("en-LK",{minimumFractionDigits:2,maximumFractionDigits:2})} LKR`;function G({open:c,onClose:d,orderId:o,total:u,qrDataUrl:r}){if(!c)return null;const g=()=>{const i=document.createElement("a");i.href=r,i.download=`EventzOne_${o}_QR.png`,document.body.appendChild(i),i.click(),i.remove()},h=async()=>{try{await navigator.clipboard.writeText(r),alert("QR image link copied.")}catch{alert("Could not copy. Long-press the QR to save.")}};return e.jsx("div",{className:"fixed inset-0 z-[90] grid place-items-center bg-black/60 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-white/10 bg-gray-900 p-5 shadow-2xl",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-teal-50",children:"Scan to Pay"}),e.jsx("button",{onClick:d,className:"rounded-md p-2 text-teal-200/70 hover:bg-white/5","aria-label":"Close",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"text-sm text-teal-200/80",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Order ID"}),e.jsx("span",{className:"font-semibold text-teal-50",children:o})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-bold text-amber-300",children:y(u)})]})]}),e.jsxs("div",{className:"mt-5 grid place-items-center",children:[e.jsx("img",{src:r,alt:"Payment QR",className:"h-auto w-64 max-w-full rounded-xl border border-white/10 bg-white/5 p-3"}),e.jsx("p",{className:"mt-3 text-center text-xs text-teal-200/70",children:"Use your banking app’s QR scanner."})]}),e.jsxs("div",{className:"mt-5 grid gap-2 sm:grid-cols-2",children:[e.jsxs("button",{onClick:g,className:"inline-flex items-center justify-center gap-2 rounded-xl bg-amber-300 px-4 py-2 font-semibold text-gray-900 hover:bg-amber-200",children:[e.jsx(W,{className:"h-4 w-4"}),"Download PNG"]}),e.jsxs("button",{onClick:h,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-4 py-2 font-semibold text-teal-100 hover:bg-white/10",children:[e.jsx(K,{className:"h-4 w-4"}),"Copy link"]})]}),e.jsx("p",{className:"mt-3 text-center text-[11px] text-teal-200/60",children:"On mobile, long-press the QR to save it."})]})})}function te(){const c=B(),{state:d}=q(),o=Array.isArray(d==null?void 0:d.items)?d.items:[],u=o.length>=1&&o.every(t=>(t==null?void 0:t.type)==="vipTable"),r=l.useMemo(()=>{if(u){const t=[];for(const a of o){const s=a.qty??1;for(let m=0;m<s;m++)for(let x=0;x<10;x++)t.push({id:`${a.tableId}-${x+1}${m?`-${m+1}`:""}`,tableId:a.tableId,seatNo:x+1,category:"vip",price:7e3})}return t}return o.map(t=>({id:t.id,tableId:t.tableId,seatNo:t.seatNo,category:(t.category||"general").toLowerCase(),price:t.price||0}))},[o,u]),g=l.useMemo(()=>{const t={};for(const a of r){const s=(a.category||"general").toLowerCase();t[s]||(t[s]={qty:0,amount:0}),t[s].qty+=1,t[s].amount+=a.price||0}return t},[r]),h=l.useMemo(()=>r.reduce((t,a)=>t+(a.price||0),0),[r]),[i]=l.useState(()=>Date.now()+10*60*1e3),[j,S]=l.useState(Math.max(0,Math.floor((i-Date.now())/1e3)));l.useEffect(()=>{const t=setInterval(()=>{const a=Math.max(0,Math.floor((i-Date.now())/1e3));S(a),a<=0&&clearInterval(t)},250);return()=>clearInterval(t)},[i]);const I=String(Math.floor(j/60)).padStart(2,"0"),M=String(j%60).padStart(2,"0"),[n,L]=l.useState({first:"",last:"",email:"",dial:"+94",phone:"",idType:"NIC"}),p=(t,a)=>L(s=>({...s,[t]:a})),[b,P]=l.useState(!1),[v,D]=l.useState(!1),[f,N]=l.useState(!1),[R,w]=l.useState(!1),[_,O]=l.useState(""),[E,$]=l.useState(""),T=()=>r.map(t=>({id:t.id,tableId:t.tableId,seatNo:t.seatNo,category:t.category,price:t.price}));async function A(){if(!(!r.length||!b)){N(!0);try{const t=T(),{toDataURL:a}=await F(async()=>{const{toDataURL:Q}=await import("./browser-DxcIQDIk.js").then(V=>V.b);return{toDataURL:Q}},[]),s="EVZ-"+Math.random().toString(36).slice(2,7).toUpperCase();$(s);const m={orderId:s,amount:h,currency:"LKR",description:"Eventz One Tickets",items:t,customer:{name:`${(n.first||"").trim()} ${(n.last||"").trim()}`.trim(),email:n.email,phone:`${n.dial} ${n.phone}`.trim(),idType:n.idType,newsletter:v},payVia:"ONEPAY_CARD",ts:new Date().toISOString()},x=await a(JSON.stringify(m),{errorCorrectionLevel:"M",margin:1,scale:8});O(x),w(!0)}catch(t){console.error(t),alert("Failed to prepare payment. Please try again.")}finally{N(!1)}}}return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-teal-100",children:[e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-3 py-6 sm:px-4 sm:py-10",children:[e.jsxs("button",{onClick:()=>c(-1),className:"mb-4 inline-flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-sm hover:bg-white/10",children:[e.jsx(k,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-12",children:[e.jsxs("section",{className:"md:col-span-7 rounded-2xl border border-white/10 bg-gray-900/60 p-5",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Billing Details"}),e.jsxs("div",{className:"mt-3 text-[22px] font-semibold text-teal-50",children:[I,":",M," ",e.jsx("span",{className:"align-middle text-sm font-normal text-teal-200/70",children:"Minutes Left to Confirm Your Booking…"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("input",{className:"w-full rounded-lg border border-white/10 bg-gray-900 px-3 py-2 text-teal-100 outline-none placeholder:text-teal-200/50 focus:ring-2 focus:ring-emerald-600",placeholder:"Write your first name",value:n.first,onChange:t=>p("first",t.target.value)}),e.jsx("input",{className:"w-full rounded-lg border border-white/10 bg-gray-900 px-3 py-2 text-teal-100 outline-none placeholder:text-teal-200/50 focus:ring-2 focus:ring-emerald-600",placeholder:"Write your last name",value:n.last,onChange:t=>p("last",t.target.value)}),e.jsx("input",{className:"w-full rounded-lg border border-white/10 bg-gray-900 px-3 py-2 text-teal-100 outline-none placeholder:text-teal-200/50 focus:ring-2 focus:ring-emerald-600",placeholder:"Write your email address",type:"email",value:n.email,onChange:t=>p("email",t.target.value)}),e.jsxs("div",{className:"grid grid-cols-[110px_1fr] gap-3",children:[e.jsxs("select",{className:"w-full rounded-lg border border-white/10 bg-gray-900 px-3 py-2 text-teal-100 outline-none focus:ring-2 focus:ring-emerald-600",value:n.dial,onChange:t=>p("dial",t.target.value),children:[e.jsx("option",{value:"+94",children:"+94"}),e.jsx("option",{value:"+91",children:"+91"}),e.jsx("option",{value:"+65",children:"+65"}),e.jsx("option",{value:"+971",children:"+971"})]}),e.jsx("input",{className:"w-full rounded-lg border border-white/10 bg-gray-900 px-3 py-2 text-teal-100 outline-none placeholder:text-teal-200/50 focus:ring-2 focus:ring-emerald-600",placeholder:"Write your phone number",value:n.phone,onChange:t=>p("phone",t.target.value)})]})]})]}),e.jsx("section",{className:"md:col-span-5 space-y-6",children:e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-gray-900/60 p-5",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Booking Summary"}),e.jsx("div",{className:"max-h-64 overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.length===0?e.jsx("div",{className:"px-4 py-3 text-teal-200/75",children:"No tickets selected."}):r.map(t=>e.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 px-4 py-2 text-sm last:border-b-0",children:[e.jsxs("div",{className:"text-teal-100",children:[e.jsx("span",{className:"font-medium uppercase",children:t.category})," ","• ",t.tableId," – Seat ",t.seatNo]}),e.jsx("div",{className:"font-semibold text-amber-300",children:y(t.price)})]},t.id))}),e.jsx("div",{className:"mt-4 divide-y divide-white/10 rounded-xl bg-white/5",children:Object.keys(g).map(t=>{const a=t==="vip"?"VIP":"GENERAL",s=g[t];return e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-teal-50",children:a}),e.jsxs("div",{className:"text-xs text-teal-300/80",children:[s.qty," ticket",s.qty!==1?"s":""]})]}),e.jsx("div",{className:"font-semibold text-amber-300",children:y(s.amount)})]},t)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-xl bg-white/5 px-4 py-3 text-base font-semibold",children:[e.jsx("span",{className:"text-teal-100",children:"Total"}),e.jsx("span",{className:"text-amber-300",children:y(h)})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3 rounded-xl border border-white/10 bg-gray-900 px-4 py-3",children:[e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg",alt:"VISA",className:"h-6 invert"}),e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/a/a4/Mastercard_2019_logo.svg",alt:"Mastercard",className:"h-6"}),e.jsxs("div",{className:"ml-auto text-right text-xs leading-4 text-teal-200/80",children:[e.jsx("div",{className:"font-semibold text-teal-50",children:"Onepay"}),e.jsx("div",{children:"Pay via VISA / Master "})]})]}),e.jsxs("div",{className:"mt-5 space-y-3 text-sm text-teal-200/80",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-emerald-500",checked:b,onChange:t=>P(t.target.checked)}),e.jsx("span",{children:"I have read the Terms and Conditions of attendance."})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-emerald-500",checked:v,onChange:t=>D(t.target.checked)}),e.jsx("span",{children:"Subscribe for newsletters."})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"grid h-12 w-12 place-items-center rounded-xl border border-white/10 bg-white/5 hover:bg-white/10","aria-label":"Back",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx("button",{disabled:f||!r.length||!b,onClick:A,className:`flex-1 rounded-xl px-5 py-3 text-center font-bold transition ${f||!r.length||!b?"cursor-not-allowed bg-white/10 text-teal-300/50":"bg-amber-300 text-gray-900 hover:bg-amber-200"}`,children:f?"Preparing…":"Proceed to Pay"})]})]})})]})]}),e.jsx(U,{}),e.jsx(G,{open:R,onClose:()=>w(!1),orderId:E,total:h,qrDataUrl:_})]})}export{te as default};
